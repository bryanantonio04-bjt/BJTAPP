<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BJT Solution | Control Panel</title>

  <style>
    :root {
      --fondo:#333; --oliva:#556b2f; --amarillo:#ffd35b;
      --gris:#efefed; --card:#444;
    }

    body{
      margin:0; padding:16px;
      background:var(--fondo); color:var(--gris);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    }

    header{
      max-width:1200px; margin:0 auto 20px;
      display:flex; flex-wrap:wrap; gap:12px;
      align-items:center; justify-content:space-between;
    }

    nav{
      display:flex; gap:6px; flex-wrap:wrap;
      background:rgba(255,255,255,.05);
      padding:6px; border-radius:14px;
    }
    nav button{
      border:none; background:none; color:#888;
      padding:10px 16px; border-radius:12px;
      font-weight:600; cursor:pointer;
    }
    nav button.active{ background:rgba(255,255,255,.1); color:var(--amarillo); }

    .btn{
      border:none; border-radius:12px; cursor:pointer;
      padding:10px 16px; font-weight:600;
    }
    .btn-main{ background:var(--oliva); color:#fff; }
    .btn-outline{ background:none; border:1px solid #555; color:#aaa; }

    .view{ max-width:1200px; margin:0 auto; display:none; }

    /* LOGIN */
    .login{
      min-height:100vh; display:flex;
      align-items:center; justify-content:center;
    }
    .login-box{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px; padding:24px;
      width:min(420px,92vw);
    }
    input,textarea,select{
      width:100%; box-sizing:border-box;
      background:#333; border:1px solid #444;
      color:#fff; padding:12px;
      border-radius:10px; margin-bottom:12px;
    }

    /* CLIENTES */
    .grid{
      display:grid; gap:16px;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    }
    .card{
      background:var(--card); padding:16px;
      border-radius:16px;
    }
    .note{
      margin-top:8px; font-size:12px;
      opacity:.85; white-space:pre-wrap;
      background:rgba(255,255,255,.05);
      padding:10px; border-radius:10px;
    }

    /* MODAL */
    .modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.8); z-index:100;
    }
    .modal-box{
      background:#222; padding:24px;
      border-radius:20px; width:min(420px,92vw);
      border:1px solid #444;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login">
  <div class="login-box">
    <h2 style="color:var(--amarillo);margin-top:0">BJT Panel</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="pass" type="password" placeholder="ContraseÃ±a">
    <button class="btn btn-main" onclick="login()">Entrar</button>
    <button class="btn btn-outline" onclick="signup()">Crear cuenta</button>
    <div id="loginMsg" style="font-size:12px;opacity:.6;margin-top:10px"></div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">

<header>
  <strong>BJT Solution</strong>
  <nav>
    <button id="t1" class="active" onclick="tab('clientes')">Clientes</button>
    <button id="t2" onclick="tab('tareas')">Tareas</button>
    <button id="t3" onclick="tab('facturas')">Facturas</button>
  </nav>
  <button class="btn btn-outline" onclick="logout()">Salir</button>
</header>

<!-- CLIENTES -->
<div id="clientes" class="view" style="display:block">
  <button class="btn btn-main" onclick="openClient()">+ Cliente</button>
  <div class="grid" id="clientList"></div>
</div>

<!-- TAREAS -->
<div id="tareas" class="view">
  <p>ðŸ›  (las tareas quedan igual que tu versiÃ³n previa, ligadas a clientes)</p>
</div>

<!-- FACTURAS -->
<div id="facturas" class="view">
  <p>ðŸ’° (facturas sincronizadas y ligadas a clientes)</p>
</div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3 id="mTitle"></h3>
    <div id="mBody"></div>
    <button class="btn btn-main" onclick="save()">Guardar</button>
    <button class="btn btn-outline" onclick="closeModal()">Cerrar</button>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword,
createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* ðŸ”¥ REEMPLAZÃ ESTO CON TU CONFIG ðŸ”¥ */
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROJECT.firebaseapp.com",
  projectId: "TU_PROJECT",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let user=null;
let clients=[];

/* AUTH */
onAuthStateChanged(auth,u=>{
  user=u;
  document.getElementById("login").style.display=u?"none":"flex";
  document.getElementById("app").style.display=u?"block":"none";
  if(u) listenClients();
});

window.login=async()=>{
  try{
    await signInWithEmailAndPassword(auth,email.value,pass.value);
  }catch(e){ loginMsg.innerText=e.message }
};
window.signup=async()=>{
  try{
    await createUserWithEmailAndPassword(auth,email.value,pass.value);
  }catch(e){ loginMsg.innerText=e.message }
};
window.logout=()=>signOut(auth);

/* CLIENTES */
function listenClients(){
  onSnapshot(collection(db,"users",user.uid,"clients"),snap=>{
    clients=snap.docs.map(d=>({id:d.id,...d.data()}));
    renderClients();
  });
}
function renderClients(){
  clientList.innerHTML="";
  clients.forEach(c=>{
    clientList.innerHTML+=`
      <div class="card">
        <strong>${c.name}</strong>
        <div style="font-size:12px;opacity:.6">${c.email||""}</div>
        <div class="note">${c.notes||"Sin notas"}</div>
        <button class="btn btn-outline" onclick="editNotes('${c.id}')">Notas</button>
      </div>`;
  });
}

window.openClient=()=>{
  mTitle.innerText="Nuevo cliente";
  mBody.innerHTML=`
    <input id="cName" placeholder="Nombre">
    <input id="cEmail" placeholder="Email">
    <textarea id="cNotes" placeholder="Notas"></textarea>`;
  modal.style.display="flex";
  modal.dataset.type="newClient";
};

window.editNotes=id=>{
  const c=clients.find(x=>x.id===id);
  mTitle.innerText="Notas";
  mBody.innerHTML=`<textarea id="cNotes" rows="6">${c.notes||""}</textarea>`;
  modal.style.display="flex";
  modal.dataset.type="editNotes";
  modal.dataset.id=id;
};

window.save=async()=>{
  if(modal.dataset.type==="newClient"){
    await addDoc(collection(db,"users",user.uid,"clients"),{
      name:cName.value,email:cEmail.value,notes:cNotes.value
    });
  }
  modal.style.display="none";
};
window.closeModal=()=>modal.style.display="none";

/* UI */
window.tab=t=>{
  ["clientes","tareas","facturas"].forEach(v=>{
    document.getElementById(v).style.display=v===t?"block":"none";
  });
  ["t1","t2","t3"].forEach((id,i)=>{
    document.getElementById(id).classList.toggle("active",[ "clientes","tareas","facturas" ][i]===t);
  });
};
</script>

</body>
</html>
